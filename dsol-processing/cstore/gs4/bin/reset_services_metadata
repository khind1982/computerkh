#!/usr/bin/env bash

# Given a product code and a handover directory, delete pagefiles and hit
# highlighting lock files for all issues in the handover. This is much more
# reliable than using the -r option to genmsmetadata, which doesn't seem to
# work properly...

function usage() {
    echo "$(basename $0) <product> <handover>"
    exit 1
}

case $# in
    2)
        product=$1
        handover=$2
        ;;
    *)
        usage
        ;;
esac

issuelist=($(find "${handover}" -type f | \
                    awk -F/ '{print $NF}' | \
                    awk -F_ '{print $1"_"$2"_"$3}' | \
                    sort -u))

for issue in ${issuelist[*]}
do
    jid=${issue:0:9}
    year=${issue:10:4}
    month=${issue:14:2}
    rm -rf "/dc/dsol/np/ms/pagefiles/${product}/${jid}/${issue}"
    rm -rf "/dc/dsol/np/ms/pagefiles/.lock/${product}/${jid}/${year}/${month}"
done
