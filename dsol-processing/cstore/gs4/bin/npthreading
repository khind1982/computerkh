#!/usr/bin/env python
# -*- mode: python -*-

# A wrapper around the eima_pagemap stuff.

import sys

from eima_pagemap import *
from eimabits import *


def main(product, resizelist, sourcedata):
    print >> sys.stderr, "populatethreading..."
    populatethreading(product, sourcedata)
    a = pagemapgenerator(product)
    print >> sys.stderr, "getresizefactors..."
    a.getresizefactors(resizelist)
    print >> sys.stderr, "gatherdata..."
    a.gatherdata(sourcedata)
    print >> sys.stderr, "populate_pagethreading..."
    a.populate_pagethreading()
    print >> sys.stderr, "populate_hithighlighting_threading..."
    a.populate_hithighlighting_threading()
    print >> sys.stderr, "DONE!"

def undoload(product, sourcedata):
    a = pagemapgenerator(product)
    a.undoload(sourcedata)

if __name__ == '__main__':
    if len(sys.argv) < 3:
        print >> sys.stderr, "Required arguments missing"
        print >> sys.stderr, "product sourcedata"
        exit(1)

    product = sys.argv[1]
    resizelist = "/dc/dsol/steadystate/mediaservices/resize_lists/%s-resize.700" % product
    sourcedata = sys.argv[2]

#    try:
#        main(product, resizelist, sourcedata)
#    except Exception as e:
#        undoload(product, sourcedata)
#        print >> sys.stderr, "Something went wrong. All changes have been rolled back."
#        print >> sys.stderr, "The error generated this backtrace:"
#        print
#        print e

    main(product, resizelist, sourcedata)
