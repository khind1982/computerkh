#!/usr/bin/env python2.7
# -*- mode: python -*-
# pylint: disable = F0401

# A standalone wrapper for the new threading lib. The functionality is
# integrated into the msgenmetadata script, but this might prove
# useful...

import os
import sys
sys.path.append(os.path.join(os.path.dirname(__file__), '..', 'lib'))

from tqdm import *

from msthreading import DocumentThreading
from streams.etreestream import EtreeStream

if sys.argv[1] == '-d':
    destdir = sys.argv[2]
else:
    destdir = '.'

dataroot = sys.argv[-1]

streamOpts = 'dataRoot=%s' % dataroot

optsdict = {
    'stream': '*.xml',
    'streamOpts': streamOpts,
}

for doc in tqdm(EtreeStream(optsdict).streamdata()):
    thr = DocumentThreading(doc, destdir, product)
    thr.do_threading()

thr.flush_pagecollection_threading()
