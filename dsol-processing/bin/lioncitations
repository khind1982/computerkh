#!/usr/local/bin/python2.5
# -*- mode: python -*-

import sys, os
sys.path.append(os.path.join(os.path.dirname(__file__) + '/../lib/python'))

import warnings

def doLion(ext, datalocation):
    import MySQLdb
    from citations.lion import lioncitation
   
    batch = lioncitation.LionFileBatch(filepath=datalocation, extension='.x')
    batch.ProcessBatch(workflow=batch.total_insertion)
    batch.extension = ext
    batch.ProcessBatch(workflow=batch.update_files)

if __name__ == '__main__':
    if len(sys.argv) == 1:
        print >> sys.stderr, ("Usage: lioncitations <path to datafiles> [output file extension]")
        exit(1)
    elif len(sys.argv) > 1:
        datalocation = sys.argv[1]
        # Sanity check the path
        if not os.path.isdir(datalocation):
            print >> sys.stderr, ('"%s" is not a valid directory name' % datalocation)
            exit(1)
        try:
            ext = ".%s" % sys.argv[2]
        except IndexError:
            ext = '.new'

        doLion(ext, datalocation)
