#!/usr/bin/env bash
# -*- mode: shell-script -*-
#
# List the contents of the lookup file, query it, or add values to it.

lookup="`dirname $0`/../libdata/fiaf_journal_titles.txt"

case `uname -s` in
    SunOS)
        GREP="ggrep"
        ;;
    *)
        GREP="grep"
        ;;
esac


add_title() {
    read -p "What is the journal ID? " jid
    read -p "What is the journal title? " jtitle
    read -p "Country of publication? " cpub

    entry="$jid|$jtitle ~~ $cpub"
    echo "$entry" >> $lookup
}

case $# in
    0)
        cat $lookup
        ;;
    *)
        case $1 in
            -A)
                # preformatted line
                shift
                if (echo "$@" | ${GREP} -E "^006/[0-9]{6,}\|.* ~~ .*" 2>&1 >/dev/null);
                then
                    echo "$@" >> $lookup
                    echo >> $lookup # Ensure we have in a newline at EOF
                else
                    echo "Badly formatted line. Not updating $lookup"
                fi
                ;;

            -a)
                # interactively get the details from the user
                shift
                add_title "$@"
                ;;

            *)
                ${GREP} -i -- "$1" "$lookup"
                ;;
        esac
esac

